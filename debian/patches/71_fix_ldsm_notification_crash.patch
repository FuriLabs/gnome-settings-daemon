Description: Don't access free'd memory if a volume is unmounted whilst the dialog is displayed
Author: ?

Index: gnome-settings-daemon-2.31.91/plugins/housekeeping/gsd-disk-space.c
===================================================================
--- gnome-settings-daemon-2.31.91.orig/plugins/housekeeping/gsd-disk-space.c	2010-09-01 19:01:09.452617000 +1000
+++ gnome-settings-daemon-2.31.91/plugins/housekeeping/gsd-disk-space.c	2010-09-01 19:01:53.952617002 +1000
@@ -181,7 +181,7 @@
         gboolean has_trash;
         gboolean has_disk_analyzer;
         gboolean retval = TRUE;
-        const gchar *path;
+        gchar *path;
 
         /* Don't show a dialog if one is already displayed */
         if (dialog)
@@ -190,7 +190,7 @@
         name = g_unix_mount_guess_name (mount->mount);
         free_space = (gint64) mount->buf.f_frsize * (gint64) mount->buf.f_bavail;
         has_trash = ldsm_mount_has_trash (mount);
-        path = g_unix_mount_get_mount_path (mount->mount);
+        path = g_strdup (g_unix_mount_get_mount_path (mount->mount));
 
         program = g_find_program_in_path (DISK_SPACE_ANALYZER);
         has_disk_analyzer = (program != NULL);
@@ -218,7 +218,7 @@
                 break;
         case GSD_LDSM_DIALOG_RESPONSE_ANALYZE:
                 retval = FALSE;
-                ldsm_analyze_path (g_unix_mount_get_mount_path (mount->mount));
+                ldsm_analyze_path (path);
                 break;
         case GSD_LDSM_DIALOG_RESPONSE_EMPTY_TRASH:
                 retval = TRUE;
@@ -232,6 +232,8 @@
                 g_assert_not_reached ();
         }
 
+        g_free (path);
+
         return retval;
 }
 
