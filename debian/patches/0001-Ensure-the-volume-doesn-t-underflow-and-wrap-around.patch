From f1fda217d221d071449bc251dfaab8ed2e5a06c1 Mon Sep 17 00:00:00 2001
From: Sjoerd Simons <sjoerd.simons@collabora.co.uk>
Date: Sun, 19 Dec 2010 13:48:33 +0000
Subject: [PATCH] Ensure the volume doesn't underflow and wrap around

---
 plugins/media-keys/gsd-media-keys-manager.c |   22 +++++++++++-----------
 1 files changed, 11 insertions(+), 11 deletions(-)

diff --git a/plugins/media-keys/gsd-media-keys-manager.c b/plugins/media-keys/gsd-media-keys-manager.c
index f90b563..33bb95a 100644
--- a/plugins/media-keys/gsd-media-keys-manager.c
+++ b/plugins/media-keys/gsd-media-keys-manager.c
@@ -655,20 +655,20 @@ do_sound_action (GsdMediaKeysManager *manager,
                 sound_changed = TRUE;
                 break;
         case VOLUME_DOWN_KEY:
-                if (!muted && (vol <= norm_vol_step)) {
-                        muted = !muted;
+                if (vol <= norm_vol_step) {
                         vol = 0;
-                        gvc_mixer_stream_change_is_muted (manager->priv->stream, muted);
-                        if (gvc_mixer_stream_set_volume (manager->priv->stream, vol) != FALSE) {
-                                gvc_mixer_stream_push_volume (manager->priv->stream);
-                                sound_changed = TRUE;
-                        }
                 } else {
                         vol = vol - norm_vol_step;
-                        if (gvc_mixer_stream_set_volume (manager->priv->stream, vol) != FALSE) {
-                                gvc_mixer_stream_push_volume (manager->priv->stream);
-                                sound_changed = TRUE;
-                        }
+                }
+
+                if (!muted && vol == 0) {
+                        muted = TRUE;
+                        gvc_mixer_stream_change_is_muted (manager->priv->stream, muted);
+                }
+
+                if (gvc_mixer_stream_set_volume (manager->priv->stream, vol) != FALSE) {
+                         gvc_mixer_stream_push_volume (manager->priv->stream);
+                         sound_changed = TRUE;
                 }
                 break;
         case VOLUME_UP_KEY:
-- 
1.7.2.3

